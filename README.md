# üì¶ –ü–∞–∫–µ—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä `pm`

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞–∫–µ—Ç–Ω–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –Ω–∞ Go, —Å–ø–æ—Å–æ–±–Ω–æ–≥–æ:
- –£–ø–∞–∫–æ–≤—ã–≤–∞—Ç—å —Ñ–∞–π–ª—ã –≤ –∞—Ä—Ö–∏–≤ –ø–æ –º–∞—Å–∫–µ –∏–∑ `.json` –∏–ª–∏ `.yaml`
- –ó–∞–≥—Ä—É–∂–∞—Ç—å –∞—Ä—Ö–∏–≤—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä –ø–æ SSH
- –°–∫–∞—á–∏–≤–∞—Ç—å –∏ —Ä–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞—Ç—å –ø–∞–∫–µ—Ç—ã

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
export PM_SSH_USER="–≤–∞—à_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"
export PM_SSH_HOST="–≤–∞—à.—Å–µ—Ä–≤–µ—Ä.com"
export PM_SSH_KEY="$HOME/.ssh/id_rsa"
export PM_SSH_PORT="22"
export PM_REMOTE_PATH="/tmp/pm/"
```

> üîê –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ SSH-–∫–ª—é—á –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ø–∞—Ä–æ–ª—è –∏–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω –≤ `ssh-agent`.

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É:
```bash
ssh $PM_SSH_USER@$PM_SSH_HOST "mkdir -p $PM_REMOTE_PATH"
```

---

## üìÑ –§–æ—Ä–º–∞—Ç –∫–æ–Ω—Ñ–∏–≥–æ–≤

### –ü—Ä–∏–º–µ—Ä: `packet.json` (–¥–ª—è —É–ø–∞–∫–æ–≤–∫–∏)

```json
{
  "name": "app",
  "ver": "1.0",
  "targets": [
    "./test_data/*.txt",
    { "path": "./test_data/*.log", "exclude": "*.tmp" }
  ],
  "packets": [
    { "name": "utils", "ver": ">=1.5" }
  ]
}
```

### –ü—Ä–∏–º–µ—Ä: `packages.json` (–¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏)

```json
{
  "packages": [
    { "name": "app", "ver": ">=1.0" },
    { "name": "utils" }
  ]
}
```

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: `.json`, `.yaml`, `.yml`

---

## üß∞ –ö–æ–º–∞–Ω–¥—ã –∏–∑ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è

### `pm create ./packet.json` ‚Äî —É–ø–∞–∫–æ–≤–∞—Ç—å –∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å

```bash
./pm create ./packet.json
```

–∏–ª–∏ —Å `make`:

```bash
make create CONFIG=packet.json
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. –°–æ–±–∏—Ä–∞–µ—Ç —Ñ–∞–π–ª—ã –ø–æ –º–∞—Å–∫–∞–º –∏–∑ `targets`
2. –ò—Å–∫–ª—é—á–∞–µ—Ç —Ñ–∞–π–ª—ã –ø–æ `exclude`
3. –£–ø–∞–∫–æ–≤—ã–≤–∞–µ—Ç –≤ `app-1.0.zip`
4. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä –≤ `$PM_REMOTE_PATH`

---

### `pm update ./packages.json` ‚Äî —Å–∫–∞—á–∞—Ç—å –∏ —Ä–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å

```bash
./pm update ./packages.json
```

–∏–ª–∏:

```bash
make update CONFIG=packages.json
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∞–∫–µ—Ç–∞ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∏–º—è –∞—Ä—Ö–∏–≤–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `app-1.0.zip`)
2. –°–∫–∞—á–∏–≤–∞–µ—Ç —Å —Å–µ—Ä–≤–µ—Ä–∞ –ø–æ SSH
3. –†–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ—Ç –≤ —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é

---

## üõ† Makefile: –£–¥–æ–±–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|--------|
| `make` | –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É |
| `make build` | –°–æ–±—Ä–∞—Ç—å `pm` |
| `make test` | –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã |
| `make test-coverage` | –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞ (`coverage.html`) |
| `make deps` | –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ |
| `make clean` | –£–¥–∞–ª–∏—Ç—å `pm` –∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã |
| `make create CONFIG=file.json` | –í—ã–ø–æ–ª–Ω–∏—Ç—å `pm create` |
| `make update CONFIG=file.json` | –í—ã–ø–æ–ª–Ω–∏—Ç—å `pm update` |
| `make example-configs` | –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥–æ–≤ |
| `make lint` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥ (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `golangci-lint`) |

---

## üß™ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

```bash
mkdir -p test_data
echo "Hello" > test_data/file1.txt
echo "Temp" > test_data/temp.log.tmp
echo "Log" > test_data/app.log
```

### 2. –°–æ–∑–¥–∞–π—Ç–µ `packet.json`

```json
{
  "name": "test-pkg",
  "ver": "1.0",
  "targets": [
    "./test_data/*.txt",
    { "path": "./test_data/*.log", "exclude": "*.tmp" }
  ]
}
```

### 3. –£–ø–∞–∫—É–π—Ç–µ –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ

```bash
export PM_SSH_USER=ubuntu
export PM_SSH_HOST=192.168.1.100
export PM_SSH_KEY=~/.ssh/id_rsa
export PM_REMOTE_PATH=/tmp/pm/

./pm create packet.json
```

> –ê—Ä—Ö–∏–≤ `test-pkg-1.0.zip` –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä.

### 4. –°–∫–∞—á–∞–π—Ç–µ –∏ —Ä–∞—Å–ø–∞–∫—É–π—Ç–µ

–°–æ–∑–¥–∞–π—Ç–µ `packages.json`:

```json
{
  "packages": [
    { "name": "test-pkg", "ver": "1.0" }
  ]
}
```

–ó–∞–ø—É—Å—Ç–∏—Ç–µ:

```bash
./pm update packages.json
```

> –ê—Ä—Ö–∏–≤ –±—É–¥–µ—Ç —Å–∫–∞—á–∞–Ω –∏ —Ä–∞—Å–ø–∞–∫–æ–≤–∞–Ω –≤ —Ç–µ–∫—É—â—É—é –ø–∞–ø–∫—É.
